<!--INFO 3300 Project 2-->
<!--Created by -->
<head>
    <title>Recipe Visualization</title>
    <link rel="stylesheet" href="css/stylesheet.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src = 'script/underscore.js'></script> 
    <script src = 'script/script.js'></script>
    <script src = 'https://cdnjs.cloudflare.com/ajax/libs/fuse.js/2.6.1/fuse.min.js'></script> 
    <script src="script/search.js"></script>
    <style>
        /*svg {border: 1px black solid;}*/
        body {font-family: 'Alegreya Sans', Calibri, sans-serif;}
        #text {font-size: 15; font-weight: bold;}
    </style>
</head>
<body>
    <svg width = '2000' height = '1200'>
        <g id = "axes"></g>
        <g id= "text"></g>
        <g id = "bars"></g>
    </svg>
    <form>
        <input type ='text' id = 'search-box'></input>
        <input type = 'submit' id = 'submit'></input>
    </form>
    <h2 id = 'ing-name'>Recipes</h2>
    <h3 id = "recipe-list"></h3>
</body>
<script>
    var data, data2, scale, recipe_data, slow_write;
    var color_scale = ['#67001f','#b2182b','#d6604d','#f4a582','#fddbc7','#ffffff','#e0e0e0','#bababa','#878787','#4d4d4d','#1a1a1a'];
    var nutrient_list = ['Calories', 'Fat', 'Cholesterol','Carbohydrates', 'Fiber','Sugar',
     'Protein', 'Calcium', 'Iron', 'Vitamin A', 'Vitamin C'];
    var svg = d3.select("svg");
    svg.append("rect").attr("width", 2000).attr("height", 1200).style("fill", "green").style("fill-opacity", 0.1);

	d3.queue()
	//load recipe data from epicurious.com
	//load nutrition data from usda
    .defer(d3.json, "data/recipe_to_nutrition_final.json")
    .defer(d3.json, "data/nutrition_reduced.json")
    //.defer(d3.json, "data/reduced_recipes_with_units.json")
    .await(function (error, file1, file2, file3) {
        console.log(error);
        //{recipe: {ing1:{NDBNo:#, magnitude:#, unit: 'gram'}, ing2: {NDBNo:#, magnitude:#, unit: 'gram'}}, recipe2...}
        data = file1;
        var recipe_ing = {};
        for (var i = 0; i < data.length; i++){
            //console.log(Object.keys(data[i])[0]);
            //console.log(data[i][Object.keys(data[i])[0]]);
            recipe_ing[Object.keys(data[i])[0]] = data[i][Object.keys(data[i])[0]];
        }
        ing_nut = file2;
        var scales = [];
        create_axis(scales);
        create_graph('Chicken with Sun-Dried Tomato Cream Sauce ', recipe_ing, ing_nut, scales);
  
        // searching the recipe section
        // $("input").keyup(function(){
        //    var val = this.value;
        //    slow_write(val);
        // });

         // console.log(recipe_ing);
        // var recipes = Object.keys(recipe_ing);
        // var random_recipe = recipes[Math.round(Math.random()*6791)];
        // console.log(random_recipe);

        //at some point, prevent enter pressing/make it call search function

        document.getElementById("recipe-list").innerHTML = "You searched for: stuff <br>";
        for (var i = 0; i < 10; i++){
            document.getElementById("recipe-list").innerHTML += Object.keys(recipe_ing)[i] + "<br>";
            var ing_list = Object.keys(recipe_ing[Object.keys(recipe_ing)[i]]);
            for (var j = 0; j < ing_list.length; j++){
                document.getElementById("recipe-list").innerHTML += ing_list[j] + "<br>";
            }
        }
        
    });
	
	/* Macronutrient Calculator */
	function BMRCalculator(gender, weight, height, age){
		//gender: 0 = male, 1 = female
		if (gender == 1)
			return 655.1 + (4.35 * weight) + (4.7 * height) - (4.7 * age);
		else
			return 66 + (6.2 * weight) + (12.7 * height) - (6.76 * age);
	}
	
	function caloriesCalculator(exercise, BMR){
		return BMR * (1.2 + exercise * 0.175);
	}
	
	function macronutrientCalculator(ratio, calories){
		//ratio = 0, body building ratio 50-30-20 (carb-protein-fat)
		//ratio = 1, maintenance ratio 40-30-30
		//ratio = 2, fat loss ratio 20-35-45
		if (ratio == 0)
			return [calories * .5 / 4, calories * .3 / 4, calories * .2 / 9];
		else if (ratio == 1)
			return [calories * .4 / 4, calories * .3 / 4, calories * .3 / 9];
		else if (ratio == 2)
			return [calories * .2 / 4, calories * .35 / 4, calories * .45 / 9];
		else
			return [281, 112.5, 75];
	}
</script>
<script>
</script>